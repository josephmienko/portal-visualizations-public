!function t(e,a,n){function i(s,l){if(!a[s]){if(!e[s]){var o="function"==typeof require&&require;if(!l&&o)return o(s,!0);if(r)return r(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var c=a[s]={exports:{}};e[s][0].call(c.exports,function(t){var a=e[s][1][t];return i(a?a:t)},c,c.exports,t,e,a,n)}return a[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,e,a){var n=t("./modules/ContextSwitcher.js"),i=(t("./modules/Listener.js"),t("./modules/DataService.js")),r=t("./modules/Filters.js"),s=t("./modules/Legend.js"),l=t("./modules/Map.js"),o=t("./modules/Table.js"),d={init:function(t){var e=this,a=t.title,d=t.config.defaultContext,c=t.config.file,u=t.config.mapType,p=t.config.legendLabel,f=t.subtitle;l.context=d,l.type=u,i.init(c,d),r.init(),l.init(d,u),n.init(d),s.init(p),o.init(d,p),e.appendPageTitle(a,f)},appendPageTitle:function(t,e){$("#data-title h2").text(t),"undefined"!=typeof e?$("#data-title h4").text(e):$("#data-title h4").remove()}};window.MapApp=d},{"./modules/ContextSwitcher.js":2,"./modules/DataService.js":3,"./modules/Filters.js":4,"./modules/Legend.js":5,"./modules/Listener.js":6,"./modules/Map.js":7,"./modules/Table.js":8}],2:[function(t,e,a){var n=t("./Listener.js");e.exports={init:function(t){$("#options").val(t),this.bindUIEvents()},bindUIEvents:function(){$("#options").change(function(){var t=$(this).val();n.publish("Switch contexts",{newContext:t})})}}},{"./Listener.js":6}],3:[function(t,e,a){var n=t("./Listener.js"),i=t("./Utils.js");e.exports={init:function(t,e){var a=this;a.loadData(t,e,"Data loaded"),n.subscribe("Switch contexts",function(e){var n=e.newContext;a.loadData(t,n,"New data context")})},update:function(t,e){var a=this,i=!1,r=a.getViewData(t,e,i);n.publish("Data updated",{data:r,headerKeys:e})},loadData:function(t,e,a){var i=this,r=(t.split("_")[0],"../../data/maps/"+t+"_"+e+".csv");d3.csv(r,function(t,e){if(t)return console.warn(t);var r=!0,e=e,s=i.getHeaderKeys(e),l=i.getViewData(e,s,r),o=l;n.publish(a,{data:l,headerKeys:s}),i.bindUIEvents(e,s,o)})},getViewData:function(t,e,a){var n=i.getFilterSelections(t,e,a),r=t.filter(function(t){return e.reduce(function(e,a){return e&&(!n[a]||t[a]===n[a]||n[a].indexOf(t[a])>=0)},!0)});return r},getHeaderKeys:function(t){var e=d3.keys(t[0]),a=e.length-2;return e.splice(a),e},bindUIEvents:function(t,e,a){var i=this;$("#update").click(function(){$(this).removeClass("highlighted"),i.update(t,e)}),$("#reset").click(function(){n.publish("Data reset",{data:a})})}}},{"./Listener.js":6,"./Utils.js":9}],4:[function(t,e,a){var n=t("./Listener.js"),i=t("./Utils.js");e.exports={init:function(){var t=this;n.subscribe("Data loaded",function(e){t.displayFilters(e.headerKeys)})},reset:function(){$(".fieldInput").each(function(){$(this).prop("selectedIndex",0)}),$("#fieldInput-date_type").val("2018"),$("#fieldInput-date_year").val("2018")},displayFilters:function(t){var e=this;d3.json("/data/params-display.json",function(a,n){var r=i.matchKeysToParams(t);$.each(n,function(t,a){if(legend=a.display.legend,selected=a.display.selected,help=a.display.help,"object"==typeof help){var n=help;help=n["default"]}-1!=r.indexOf(t)&&"ethnicity"!==t&&"age"!==t&&(filterName=t,"date_type"===filterName&&(selected="2018-01-01 00:00:00"),e.appendFilter(filterName,help),e.appendFilterOptions(filterName,selected),"undefined"!=typeof filterValuesToSelect&&"Default filter values"!==filterValuesToSelect&&selectFilterValues(filterValuesToSelect))})})},appendFilter:function(t){d3.select("#filters").append("li").attr("id",t).attr("class","field"),d3.select("#"+t).append("fieldset").attr("id","fieldset-"+t).attr("class","fieldset").append("label").text(legend),d3.select("#"+t+" fieldset").append("select").attr("class","fieldInput browser-default").attr("name","fieldInput-"+t).attr("id","fieldInput-"+t),help&&d3.select("#"+t+" .fieldsetHeader").append("span").attr("class","help")},appendFilterOptions:function(t,e){$.each(mapParams,function(e,a){param=a.param,t==param&&(options=a.map,$.each(options,function(e,a){d3.select("#fieldInput-"+t).append("option").attr("value",e).text(a)}))}),"undefined"!=typeof e?$("#fieldInput-"+t).val(e):$("#fieldInput-"+t).val(0)},bindUIEvents:function(){$(".fieldInput").change(function(){$("#update").addClass("highlighted")})},appendHelpText:function(){},selectFilterValues:function(t){for(var e in t){var a=t[e].split("=")[1],n=t[e].split("=")[0];$("select#fieldInput-"+n).val(a)}}}},{"./Listener.js":6,"./Utils.js":9}],5:[function(t,e,a){var n=t("./Listener.js"),i=t("./Utils.js");e.exports={init:function(t){var e=this;n.subscribe("Map colorized",function(t){e.appendSVG(t.scale)}),"undefined"!=typeof t&&$("#legend-label").text(t)},appendSVG:function(t){var e=300,a=d3.select("#legend").append("svg").attr("id","map_legend"),n=a.selectAll("g.legendEntry").data(t.range().reverse()).enter().append("g").attr("class","legendEntry");n.append("rect").attr("x",e-280).attr("y",function(t,e){return 20*e}).attr("width",10).attr("height",10),n.append("text").attr("x",e-265).attr("y",function(t,e){return 20*e}).attr("dy","0.8em").text(function(e,a){var n=t.invertExtent(e),r=i.getNumberFormat();return r(+n[0])+" - "+r(+n[1])})}}},{"./Listener.js":6,"./Utils.js":9}],6:[function(t,e,a){var n=function(){var t={},e=t.hasOwnProperty;return{subscribe:function(a,n){e.call(t,a)||(t[a]=[]);var i=t[a].push(n)-1;return{remove:function(){delete t[a][i]}}},publish:function(a,n){e.call(t,a)&&t[a].forEach(function(t){t(void 0!=n?n:{})})}}}();e.exports=n},{}],7:[function(t,e,a){var n=t("./Listener.js"),i=t("./Utils.js");e.exports={init:function(){var t=this;n.subscribe("Data loaded",function(e){t.appendSVG(),t.colorizeSVG(e.data),t.bindUIEvents()}),n.subscribe("Switch contexts",function(e){$("#wa_"+t.context+"_map").remove(),t.context=e.newContext}),n.subscribe("New data context",function(e){t.appendSVG(),t.colorizeSVG(e.data),t.bindUIEvents()}),n.subscribe("Data updated",function(e){t.colorizeSVG(e.data)}),n.subscribe("Data reset",function(e){t.colorizeSVG(e.data)})},appendSVG:function(){var t=this,e=t.context,a="wa_"+e+"_map",n=t.getContextSettings(e);if(0===$("#"+a).length){var i=d3.select("#map").append("svg").attr("id",a).attr("class","map").attr("viewBox",n.viewBox).attr("width",n.mapWidth).attr("height",n.mapHeight),r=i.selectAll("g").data(n.geography).enter().append("g").attr("class",e).attr("id",function(t){return t.id});r.append("path").attr("d",function(t){return t.path}).attr("id",function(t){return t.geog}).attr("name",function(t){return t.name}).attr("transform",n.transform).style("stroke","#fff").style("stroke-width",n.strokeWidth);for(var s=0,l=n.geography.length;l>s;s++)for(var o=0,d=n.extraPaths.length;d>o;o++)n.geography[s].id==n.extraPaths[o][e]&&d3.select("#"+n.geography[s].id).append("path").attr("d",n.extraPaths[o].path).style("stroke","#fff").style("stroke-width",n.strokeWidth)}},colorizeSVG:function(t){var e=this,a=e.context,i=e.type,r=e.getGeogRates(t),s=d3.min(d3.values(r)),l=d3.max(d3.values(r)),o={"q0-6":"#DADFE7","q1-6":"#B2C3D1","q2-6":"#7699B0","q3-6":"#3a6f8f","q4-6":"#224357","q5-6":"rgba(0, 0, 0, 1)"},d=d3.scale.quantize().domain([s,l]).range(d3.range(6).map(function(t){var e="q"+t+"-6",a=o[e];return a}));d3.selectAll("."+a).selectAll("path").attr("data-rate",function(t){return r.get(t.geog)}).attr("data-fill",function(t){return d(r.get(t.geog))}).style("fill",function(t){return d(r.get(t.geog))}).call(d3.helper.tooltip(function(a,n){return e.appendTooltip(a,t,i)})),d3.select("#map_legend").remove(),d3.select("#map_legend").append("rect").attr("x",20).attr("y",100).style("fill","#D9BB32").style("stroke-width","50");var c=d.copy();n.publish("Map colorized",{scale:c})},bindUIEvents:function(){var t,e=!1,a=this,n=a.context,i=a.getContextSettings(n);$(".map").on({mouseenter:function(){e===!1&&(title=$(this).attr("name"),t=$(this).attr("data-rate")),$(this).attr("style","fill: #5bb1b4;")},click:function(){var a=$(this).attr("class");if("clicked-path"==a)e=!1;else{var n=$(".clicked-path").attr("data-fill");$(".clicked-path").attr("class","").attr("style","fill: "+n+";stroke-width: "+i.strokeWidth+"; stroke: #fff;"),$(this).attr("class","clicked-path"),e=!0,title=$(this).attr("name"),t=$(this).attr("data-rate")}},mouseleave:function(){var t,a=$(this),n=$(this).attr("class");t=e===!0&&"clicked-path"==n?"#5bb1b4":a.attr("data-fill"),a.attr("style","fill: "+t+";stroke-width: "+i.strokeWidth+"; stroke: #fff;")}},"path")},getGeogRates:function(t){var e=d3.map();return t.forEach(function(t){e.set(t.geog,+t.datacol)}),e},appendTooltip:function(t,e,a){var n,r=t.geog,s=i.getNumberFormat(a);return e.forEach(function(t){t.geog==r&&(n=$("#"+r).attr("data-rate"))}),"undefined"==n&&(n="No results"),t.name+"<br/>"+a+": <span id='currRate'>"+s(n)+"</span>"},getContextSettings:function(t){var e;switch(t){case"regions":e={viewBox:"50 50 860 500",geography:regions,extraPaths:region_path,transform:"translate(0, -50)",strokeWidth:"2",mapWidth:615};break;case"counties":e={viewBox:"-32550,-19037 59361,38626",geography:counties,extraPaths:county_path,transform:"translate(0, 0)",strokeWidth:"100",mapWidth:590}}return e}}},{"./Listener.js":6,"./Utils.js":9}],8:[function(t,e,a){var n=t("./Listener.js");e.exports={init:function(t,e){var a=this;n.subscribe("Switch contexts",function(e){t=e.newContext}),n.subscribe("Map colorized",function(){a.appendTable(t,e)})},appendTable:function(t,e){var a=this,n=a.getTableData();$("#tableContent").empty();var i=[];i="regions"==t?["Region",e]:["County",e];var r=d3.select("#tableContent").append("table").attr("class","striped"),s=r.append("thead");s.append("tr").selectAll("th").data(i).enter().append("th").text(function(t){return t});var l=["name","rate"],o=d3.select("#tableContent table").append("tbody"),d=o.selectAll("tr").data(n).enter().append("tr");d.selectAll("td").data(function(t){return l.map(function(e){return{column:e,value:t[e]}})}).enter().append("td").html(function(t){return t.value});$("#table table").DataTable({bPaginate:!1,oLanguage:{sSearch:"Type and press enter to filter results: "}})},getTableData:function(){return tableData=[],$(".map path").each(function(){var t=$(this).attr("name"),e=$(this).attr("data-rate");tableData.push({name:t,rate:e})}),tableData},downloadTableData:function(){}}},{"./Listener.js":6}],9:[function(t,e,a){e.exports={getFilterSelections:function(t,e,a){var n={};if(a===!0){var i=t[1],r=Object.keys(i)[0],s=i[r];$(e).each(function(t,e){var a=e;0===t?n[a]=s:n[a]="0"})}else{var l=$("select.fieldInput");$.each(l,function(){var t=$(this).attr("id").split("fieldInput-")[1],e=$(this).val();$.each(mapParams,function(a,i){if(t==i.param){var r=a;n[r]=e}})})}return n},getNumberFormat:function(t){var e;return e="Rate"===t?d3.format(".1f"):d3.format(",.0f")},matchKeysToParams:function(t){return matchedParams=[],$.each(mapParams,function(e,a){param=a.param,-1!=t.indexOf(e)&&(matchedParams+=param)}),matchedParams},quantize:function(t,e,a){d3.scale.quantize().domain([t,e]).range(d3.range(6).map(function(t){var e="q"+t+"-6",n=a[e];return n}))}}},{}]},{},[1]);