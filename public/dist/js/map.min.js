!function t(e,a,n){function r(o,s){if(!a[o]){if(!e[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(i)return i(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var c=a[o]={exports:{}};e[o][0].call(c.exports,function(t){var a=e[o][1][t];return r(a?a:t)},c,c.exports,t,e,a,n)}return a[o].exports}for(var i="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,a){var n=t("./modules/ContextSwitcher.js"),r=(t("./modules/Listener.js"),t("./modules/DataService.js")),i=t("./modules/Citation.js"),o=t("./modules/DataDownload.js"),s=t("./modules/Filters.js"),l=t("./modules/ImageDownload.js"),d=t("./modules/Legend.js"),c=t("./modules/Map.js"),u=t("./modules/Permalink.js"),p=t("./modules/Table.js"),f={init:function(t){var e=this,a=t.title,f=t.config.defaultContext,h=t.config.file,v=t.config.mapType,g=t.config.legendLabel,m=t.subtitle,x=window.location.href,b="default";x.indexOf("&")>-1&&(b=u.getParamsArray(x),f=b.loadContext),c.context=f,c.type=v,r.init(h,f,b),s.init(b),c.init(f,v),n.init(f),d.init(g),p.init(f,g),i.init(),o.init(),l.init(),u.init(),e.appendPageTitle(a,m)},appendPageTitle:function(t,e){$("#data-title h2").text(t),"undefined"!=typeof e?$("#data-title h4").text(e):$("#data-title h4").remove()}};window.MapApp=f},{"./modules/Citation.js":2,"./modules/ContextSwitcher.js":3,"./modules/DataDownload.js":4,"./modules/DataService.js":5,"./modules/Filters.js":7,"./modules/ImageDownload.js":8,"./modules/Legend.js":9,"./modules/Listener.js":10,"./modules/Map.js":11,"./modules/Permalink.js":12,"./modules/Table.js":13}],2:[function(t,e,a){var n=t("./DetectFeatureSupport.js");e.exports={init:function(){var t=this,e=n.detectIE(),a=$("#data-title h2").text().replace(/ /g,"_");t.appendCitation(),$("#js-citationDownload").on("click",function(){var n=t.scrapeCitationDetails(),r=new Blob([n]);e?window.navigator.msSaveOrOpenBlob(r,a+".txt"):saveAs(r,a+".txt")})},appendCitation:function(){var t,e,a,n;t=$("#data-title h2").text();var r=new Date;e=r.getMonth()+1+"/"+r.getDate()+"/"+r.getFullYear(),a=r.getFullYear(),longUrl=window.location.href,n=longUrl.replace("!","").replace("#",""),$("#citation-title").empty().append(t),$("#citation-year").empty().append(a),$("#citation-date").empty().append(e),$("#citation-url").empty().append(n)},scrapeCitationDetails:function(){var t,e,a,n;return t=$("#data-title h2").text(),citation=$("#citation-example").text(),e=$("#dbUpdated").text(),a=$("#citation-url").text(),n="Citation downloaded from Center for Social Sector Analytics & Technology\r\n\r\n",n+=citation+"\r\n\r\n",n+=e+"\r\n\r\n",n+="Link: "+a}}},{"./DetectFeatureSupport.js":6}],3:[function(t,e,a){var n=t("./Listener.js");e.exports={init:function(t){window.location.hash=t,$("#options").val(t),this.bindUIEvents()},bindUIEvents:function(){$("#options").change(function(){var t=$(this).val();window.location.hash=t,n.publish("Switch contexts",{newContext:t})})}}},{"./Listener.js":10}],4:[function(t,e,a){var n=t("./DetectFeatureSupport.js"),r=function(t){var e='"'+t.replace(/"/g,'""')+'"';return e};e.exports={downloadFile:$("#data-title h2").text().replace(/ /g,"_"),init:function(){var t=this,e=n.detectIE();$("#js-dataDownload").on("click",function(){e?t.toText():t.toCSV()})},toCSV:function(){var t=",",e=this.scrapeTableData(t),a=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(a,this.downloadFile+".csv")},toText:function(){var t="\t",e=this.scrapeTableData(t),a=new Blob([e]);window.navigator.msSaveOrOpenBlob(a,this.downloadFile+".txt")},scrapeTableData:function(t){for(var e=$("table.dataTable")[0],a=e.rows.length,n=e.rows[0].cells.length,i="",o=0;o<n;o++){var s=e.rows[0].cells[o],l=r(s.innerHTML);0!==o&&(i+=t),i+=l}i+="\r\n";for(var d=1;d<a;d++){for(var c=0;c<n;c++){var u=e.rows[d].cells[c],p=u.innerHTML.split(",").join("");0!==c&&(i+=t),i+=p}i+="\r\n"}return i}}},{"./DetectFeatureSupport.js":6}],5:[function(t,e,a){var n=t("./Listener.js"),r=t("./Utils.js");e.exports={init:function(t,e,a){var r=this;r.loadOptions=a,r.loadData(t,e,"Data loaded"),n.subscribe("Switch contexts",function(e){var a=e.newContext;r.loadData(t,a,"New data context")})},update:function(t,e){var a=this,i=!1,o=r.getFilterSelections(t,e,i),s=a.filterData(t,e,o);n.publish("Data updated",{data:s,headerKeys:e})},loadData:function(t,e,a){var i=this,o=(t.split("_")[0],"../../content-data/data/maps/"+t+"_"+e+".csv");d3.csv(o,function(t){var e,o,s,l,d,c=!0,t=t,u=i.getHeaderKeys(t);"default"===i.loadOptions?(l=r.getFilterSelections(t,u,c),e=i.filterData(t,u,l),o=e):"default"!=i.loadOptions&&c===!1?(l=r.getFilterSelections(t,u,c),e=i.filterData(t,u,l),o=e):(s=i.loadOptions,l=s.filtersToSelect,e=i.filterData(t,u,l),d=r.getFilterSelections(t,u,!0),o=i.filterData(t,u,d)),n.publish(a,{data:e,headerKeys:u}),i.bindUIEvents(t,u,o)})},filterData:function(t,e,a){var n=t.filter(function(t){return e.reduce(function(e,n){return e&&(t[n]===a[n]||a[n].indexOf(t[n])>=0)},!0)});return n},getHeaderKeys:function(t){var e=d3.keys(t[0]),a=e.length-2;return e.splice(a),e},bindUIEvents:function(t,e,a){var r=this;$("#update").click(function(){$(this).removeClass("highlighted"),r.update(t,e)}),$("#reset").click(function(){n.publish("Data reset",{data:a})})}}},{"./Listener.js":10,"./Utils.js":14}],6:[function(t,e,a){e.exports={detectIE:function(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var e=navigator.userAgent,a=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=a.exec(e)&&(t=parseFloat(RegExp.$1))}else if("Netscape"==navigator.appName){var e=navigator.userAgent,a=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");null!=a.exec(e)&&(t=parseFloat(RegExp.$1))}return t!=-1},detectSVG:function(){var t="undefined"!=typeof SVGRect;return t}}},{}],7:[function(t,e,a){var n=t("./Listener.js"),r=t("./Utils.js");e.exports={init:function(t){var e=this;e.filterOptions=t,n.subscribe("Data loaded",function(t){e.displayFilters(t.headerKeys)})},reset:function(){$(".fieldInput").each(function(){$(this).prop("selectedIndex",0)}),$("#fieldInput-date_type").val("2019-01-01 00:00:00"),$("#fieldInput-date_year").val("2019-01-01 00:00:00")},displayFilters:function(t){var e=this;d3.json("/content-data/data/graphs/params-display.json",function(a,i){var o=r.matchKeysToParams(t);$.each(i,function(t,a){if(legend=a.display.legend,selected=a.display.selected,help=a.display.help,"object"==typeof help){var n=help;help=n["default"]}if(o.indexOf(t)!==-1&&"ethnicity"!==t&&"age"!==t&&(filterName=t,"date_type"===filterName&&(selected="2019-01-01 00:00:00"),e.appendFilter(filterName,help),e.appendFilterOptions(filterName,selected),"default"!=e.filterOptions)){var r=e.filterOptions,i=r.filtersToSelect;e.selectFilterValues(i)}}),n.publish("Filters loaded",{}),e.bindUIEvents()})},appendFilter:function(t){d3.select("#filters").append("li").attr("id",t).attr("class","field"),d3.select("#"+t).append("fieldset").attr("id","fieldset-"+t).attr("class","fieldset").append("label").text(legend),d3.select("#"+t+" fieldset").append("select").attr("class","fieldInput browser-default").attr("name","fieldInput-"+t).attr("id","fieldInput-"+t),help&&d3.select("#"+t+" .fieldsetHeader").append("span").attr("class","help")},appendFilterOptions:function(t,e){$.each(mapParams,function(e,a){param=a.param,t==param&&(options=a.map,$.each(options,function(e,a){d3.select("#fieldInput-"+t).append("option").attr("value",e).text(a)}))}),"undefined"!=typeof e?$("#fieldInput-"+t).val(e):$("#fieldInput-"+t).val(0)},bindUIEvents:function(){var t=this;$(".fieldInput").change(function(){$("#update").addClass("highlighted")}),$("#reset").click(function(){t.reset()})},selectFilterValues:function(t){for(var e in t){var a=e,n=t[e];$("select#fieldInput-"+a).val(n)}}}},{"./Listener.js":10,"./Utils.js":14}],8:[function(t,e,a){var n=t("./DetectFeatureSupport.js"),r=t("./Listener.js");e.exports={init:function(){var t=this;r.subscribe("Map colorized",function(e){var a=e.min,n=e.max;t.bindUIEvents(),t.graphToDataURL(a,n)})},bindUIEvents:function(){var t=this,e=n.detectSVG(),a=!1;try{a=!!new Blob}catch(r){}"undefined"!=typeof requestFileSystem||"undefined"!=typeof webkitRequestFileSystem||"undefined"!=typeof mozRequestFileSystem||"undefined"!=typeof navigator.msSaveBlob;e&&a?$("#js-imageDownload").click(function(){t.downloadImage()}):alert("Sorry, this feature is not supported for your broswer")},downloadImage:function(){var t=$("#canvas canvas"),e=$("#data-title h2").text().replace(/ /g,"_"),a=e+".png",n=$(t)[0];n.toBlob(function(t){saveAs(t,a)})},graphToDataURL:function(t,e){var a=d3.select("#data-title h2").text(),n=d3.select("#map svg").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML,r="data:image/svg+xml;base64,"+btoa(n),i='<img src="'+r+'">';d3.select("#image").html(i);var o=document.querySelector("canvas"),s=o.getContext("2d"),l=new Image;l.src=r,l.onload=function(){o.width=650,o.height=500,s.save(),s.fillStyle="#ffffff",s.fillRect(0,0,650,500),s.restore(),s.save(),s.font="20px Lucida Grande",s.textAlign="center",s.fillText(a,o.width/2,30),s.restore(),s.save(),s.drawImage(l,0,0),s.restore(),s.save();var n="Min: "+t,r="Max: "+e;s.font="14px Lucida Grande",s.fillText(n,10,450),s.fillText(r,10,470),s.restore(),s.save();var i="Data Updated: 09 May, 2014",d=new Date,c=d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear();dateText=i+"  |  Data accessed "+c,s.textAlign="left",s.fillText(dateText,10,493),s.restore(),s.save();var u="http://partnersforourchildren.org/data";s.textAlign="right",s.fillText(u,590,493),s.restore();var p=o.toDataURL("image/png"),f='<img src="'+p+'">';d3.select("#pngdataurl").html(f)}}}},{"./DetectFeatureSupport.js":6,"./Listener.js":10}],9:[function(t,e,a){var n=t("./Listener.js"),r=t("./Utils.js");e.exports={init:function(t){var e=this;n.subscribe("Map colorized",function(t){e.appendSVG(t.scale)}),"undefined"!=typeof t&&$("#legend-label").text(t)},appendSVG:function(t){var e=300,a=d3.select("#legend").append("svg").attr("id","map_legend"),n=a.selectAll("g.legendEntry").data(t.range().reverse()).enter().append("g").attr("class","legendEntry");n.append("rect").attr("x",e-280).attr("y",function(t,e){return 20*e}).attr("width",10).attr("height",10),n.append("text").attr("x",e-265).attr("y",function(t,e){return 20*e}).attr("dy","0.8em").text(function(e,a){var n=t.invertExtent(e),i=r.getNumberFormat();return i(+n[0])+" - "+i(+n[1])})}}},{"./Listener.js":10,"./Utils.js":14}],10:[function(t,e,a){var n=function(){var t={},e=t.hasOwnProperty;return{subscribe:function(a,n){e.call(t,a)||(t[a]=[]),t[a].push(n)},publish:function(a,n){e.call(t,a)&&t[a].forEach(function(t){t(void 0!=n?n:{})})}}}();e.exports=n},{}],11:[function(t,e,a){var n=t("./Listener.js"),r=t("./Utils.js");e.exports={init:function(){var t=this;n.subscribe("Data loaded",function(e){t.appendSVG(),t.colorizeSVG(e.data),t.bindUIEvents()}),n.subscribe("Switch contexts",function(e){$("#wa_"+t.context+"_map").remove(),t.context=e.newContext}),n.subscribe("New data context",function(e){t.appendSVG(),t.colorizeSVG(e.data),t.bindUIEvents()}),n.subscribe("Data updated",function(e){t.colorizeSVG(e.data)}),n.subscribe("Data reset",function(e){t.colorizeSVG(e.data)})},appendSVG:function(){var t=this,e=t.context,a="wa_"+e+"_map",n=500,r=t.getContextSettings(e);if(0===$("#"+a).length){var i=d3.select("#map").append("svg").attr("id",a).attr("class","map").attr("viewBox",r.viewBox).attr("width",r.mapWidth).attr("height",n),o=i.selectAll("g").data(r.geography).enter().append("g").attr("class",e).attr("id",function(t){return t.id});o.append("path").attr("d",function(t){return t.path}).attr("id",function(t){return t.geog}).attr("name",function(t){return t.name}).attr("transform",r.transform).style("stroke","#fff").style("stroke-width",r.strokeWidth);for(var s=0,l=r.geography.length;s<l;s++)for(var d=0,c=r.extraPaths.length;d<c;d++)r.geography[s].id==r.extraPaths[d][e]&&d3.select("#"+r.geography[s].id).append("path").attr("d",r.extraPaths[d].path).style("stroke","#fff").style("stroke-width",r.strokeWidth)}},colorizeSVG:function(t){var e=this,a=e.context,r=e.type,i=e.getGeogRates(t),o=d3.min(d3.values(i)),s=d3.max(d3.values(i)),l={"q0-6":"#DADFE7","q1-6":"#B2C3D1","q2-6":"#7699B0","q3-6":"#3a6f8f","q4-6":"#224357","q5-6":"rgba(0, 0, 0, 1)"},d=d3.scale.quantize().domain([o,s]).range(d3.range(6).map(function(t){var e="q"+t+"-6",a=l[e];return a}));d3.selectAll("."+a).selectAll("path").attr("data-rate",function(t){return i.get(t.geog)}).attr("data-fill",function(t){return d(i.get(t.geog))}).style("fill",function(t){return d(i.get(t.geog))}).call(d3.helper.tooltip(function(a,n){return e.appendTooltip(a,t,r)})),d3.select("#map_legend").remove(),d3.select("#map_legend").append("rect").attr("x",20).attr("y",100).style("fill","#D9BB32").style("stroke-width","50");var c=d.copy();n.publish("Map colorized",{scale:c,min:o,max:s})},bindUIEvents:function(){var t,e=!1,a=this,n=a.context,r=a.getContextSettings(n);$(".map").on({mouseenter:function(){e===!1&&(title=$(this).attr("name"),t=$(this).attr("data-rate")),$(this).attr("style","fill: #5bb1b4;")},click:function(){var a=$(this).attr("class");if("clicked-path"==a)e=!1;else{var n=$(".clicked-path").attr("data-fill");$(".clicked-path").attr("class","").attr("style","fill: "+n+";stroke-width: "+r.strokeWidth+"; stroke: #fff;"),$(this).attr("class","clicked-path"),e=!0,title=$(this).attr("name"),t=$(this).attr("data-rate")}},mouseleave:function(){var t,a=$(this),n=$(this).attr("class");t=e===!0&&"clicked-path"==n?"#5bb1b4":a.attr("data-fill"),a.attr("style","fill: "+t+";stroke-width: "+r.strokeWidth+"; stroke: #fff;")}},"path")},getGeogRates:function(t){var e=d3.map();return t.forEach(function(t){e.set(t.geog,+t.datacol)}),e},appendTooltip:function(t,e,a){var n,i=t.geog,o=r.getNumberFormat(a);return e.forEach(function(t){t.geog==i&&(n=$("#"+i).attr("data-rate"))}),"undefined"==n&&(n="No results"),t.name+"<br/>"+a+": <span id='currRate'>"+o(n)+"</span>"},getContextSettings:function(t){var e;switch(t){case"regions":e={viewBox:"50 50 860 500",geography:regions,extraPaths:region_path,transform:"translate(0, -50)",strokeWidth:"2",mapWidth:615};break;case"counties":e={viewBox:"-32550,-19037 59361,38626",geography:counties,extraPaths:county_path,transform:"translate(0, 0)",strokeWidth:"100",mapWidth:590}}return e}}},{"./Listener.js":10,"./Utils.js":14}],12:[function(t,e,a){var n=(t("./Listener.js"),function(){function t(){var t,e,n=function(){gapi.client.setApiKey("AIzaSyA5Jz5mOEW1k83BwmuD8O4PEKv8v0AaiEU"),gapi.client.load("urlshortener","v1",function(){})};window.onload=n,$("#js-share").click(function(){t=r(),e=a(t)})}function e(t){$("#short-url").empty(),$("#short-url").append('<a href="'+t+'">'+t+"</a>"),$("#twitter").attr("href","http://twitter.com/share?url="+t),$("#email").attr("href","mailto:"+t),$("#facebook").attr("href","http://www.facebook.com/sharer.php?u="+t)}function a(t){var a,n=gapi.client.urlshortener.url.insert({resource:{longUrl:t}});return n.execute(function(t){a=t.id,e(a)}),a}function n(t){var e,a;urlParams=t.split("#")[1],loadContext=urlParams.split("&")[0],e=urlParams.split("&"),e.shift(),a=e,urlParams={};for(var n in e){var r=e[n].split("=")[1],i=e[n].split("=")[0];"date_type"==i&&(i="date"),urlParams[i]=r}return{loadContext:loadContext,filtersToSelect:urlParams}}var r=function(){var t=i(),e=window.location.href,a="&";for(var n in t){var r=t[n];e+=a+n+"="+r}return e},i=function(){var t={};return $(".fieldInput").each(function(){var e=$(this).val(),a=$(this).attr("id").split("-")[1];if("date_type"==a){var n=e.split(" ")[0],r=n.split("-")[0];e=r}t[a]=e}),t};return{init:t,getParamsArray:n}}());e.exports=n},{"./Listener.js":10}],13:[function(t,e,a){var n=t("./Listener.js");e.exports={init:function(t,e){var a=this;n.subscribe("Switch contexts",function(e){t=e.newContext}),n.subscribe("Map colorized",function(){a.appendTable(t,e)})},appendTable:function(t,e){var a=this,n=a.getTableData();$("#tableContent").empty();var r=[];r="regions"==t?["Region",e]:["County",e];var i=d3.select("#tableContent").append("table").attr("class","striped"),o=i.append("thead");o.append("tr").selectAll("th").data(r).enter().append("th").text(function(t){return t});var s=["name","rate"],l=d3.select("#tableContent table").append("tbody"),d=l.selectAll("tr").data(n).enter().append("tr");d.selectAll("td").data(function(t){return s.map(function(e){return{column:e,value:t[e]}})}).enter().append("td").html(function(t){return t.value});$("#table table").DataTable({bPaginate:!1,oLanguage:{sSearch:"Type and press enter to filter results: "}})},getTableData:function(){return tableData=[],$(".map path").each(function(){var t=$(this).attr("name"),e=$(this).attr("data-rate");tableData.push({name:t,rate:e})}),tableData}}},{"./Listener.js":10}],14:[function(t,e,a){e.exports={getFilterSelections:function(t,e,a){var n={};if(a===!0){var r=t[1],i=Object.keys(r)[0],o=r[i];$(e).each(function(t,e){var a=e;0===t?n[a]=o:n[a]="0"})}else{var s=$("select.fieldInput");$.each(s,function(){var t=$(this).attr("id").split("fieldInput-")[1],e=$(this).val();$.each(mapParams,function(a,r){if(t==r.param){var i=a;n[i]=e}})})}return n},getNumberFormat:function(t){var e;return e="Rate"===t?d3.format(".1f"):d3.format(",.0f")},matchKeysToParams:function(t){return matchedParams=[],$.each(mapParams,function(e,a){param=a.param,t.indexOf(e)!=-1&&(matchedParams+=param)}),matchedParams},quantize:function(t,e,a){d3.scale.quantize().domain([t,e]).range(d3.range(6).map(function(t){var e="q"+t+"-6",n=a[e];return n}))}}},{}]},{},[1]);